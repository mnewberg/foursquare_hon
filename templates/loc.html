<Html>

<head>
<!-- start Mixpanel --><script type="text/javascript">(function(d,c){var a,b,g,e;a=d.createElement("script");a.type="text/javascript";a.async=!0;a.src=("https:"===d.location.protocol?"https:":"http:")+'//api.mixpanel.com/site_media/js/api/mixpanel.2.js';b=d.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b);c._i=[];c.init=function(a,d,f){var b=c;"undefined"!==typeof f?b=c[f]=[]:f="mixpanel";g="disable track track_pageview track_links track_forms register register_once unregister identify name_tag set_config".split(" ");
for(e=0;e<g.length;e++)(function(a){b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,0)))}})(g[e]);c._i.push([a,d,f])};window.mixpanel=c})(document,window.mixpanel||[]);
mixpanel.init("58e3c644f32d1b4f722dcf78a1e2cf58");</script><!-- end Mixpanel -->

		<script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.18/jquery-ui.min.js" type="text/javascript"></script>

		<script src="http://fgnass.github.com/spin.js/dist/spin.min.js"></script>
		<script type="text/javascript" src="http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.js"></script>
		<script type="text/javascript" src="http://c4261091.r91.cf2.rackcdn.com/jquery.autotab-1.1b.js"></script>
		<script type="text/javascript" src="http://c4261091.r91.cf2.rackcdn.com/4sqacplugin.js"></script>
		<script src="http://js.pusher.com/1.12/pusher.min.js"></script>

		<link href='http://fonts.googleapis.com/css?family=Lato:100,300,400,700' rel='stylesheet' type='text/css'>	
		<link rel="stylesheet" href="/static/css/style1.css" />
		
<!--		<link rel="stylesheet" href="http://staging.tryfourplay.com/static/css/customswatch.css" /> -->
		<meta name="viewport" content="width=device-width, initial-scale=1"> 
		<meta name="apple-touch-fullscreen" content="YES" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="format-detection" content="telephone=no">
		<meta name="HandheldFriendly" content="true" />



<STYLE TYPE="text/css">

.ui-autocomplete-loading { background: white url('http://jqueryui.com/demos/autocomplete/images/ui-anim_basic_16x16.gif') right center no-repeat; }
#venue { width: 25em; }
#venue-label {
display: block;
font-weight: bold;
margin-bottom: 1em;
}
#venue-icon {
float: left;
height: 32px;
width: 32px;
vertical-align: middle;
}
#venue-address {
margin: 0;
padding: 0;
}
#venue-city {
margin: 0;
padding: 0;
}

.ui-menu-item {
min-height:40px;
}

.categoryIconContainer {
border-radius: 3px 3px 3px 3px;
    float: left;
    height: 32px;
    margin-right: 5px;
    overflow: hidden;
    width: 32px;
    vertical-align: middle;
}
.autocomplete-name {
color: #333333;
    font-weight: bold;
    font-size: 13px;
    overflow: hidden;
    text-overflow: ellipsis;
    }
.autocomplete-detail {
color: #999999;
    font-weight: normal;
    font-size: 13px;
    margin-left: 40px;
    overflow: hidden;
    text-overflow: ellipsis;
    }


#grid {

    line-height: 0;
    -webkit-column-count: 3;
    -webkit-column-gap: 10px;
    -moz-column-count: 3;
    -moz-column-gap: 10px;
    column-count: 3;
    column-gap: 10px;
}
#grid img {
    width: 100% !important;
    height: auto !important;
    margin-bottom: 10px;
}
@media (max-width: 480px) {

    #grid {
    -moz-column-count: 4;
    -webkit-column-count: 4;
    column-count: 4;
    }
}
@media (max-width: 320px) {
    #grid {
    -moz-column-count: 2;
    -webkit-column-count: 2;
    column-count: 2;
    }
}
@media screen and (max-width: 320px) {
.overflow{ 
width:120px;
overflow:hidden;
align:center;
}

.target{

margin-left:-40px;

}

.ribbon_corner{
visibility:hidden;
}

.dialog_image{
max-width:180px;
}
.poptitle{
font-size:14px;

}
}
@media screen and (min-width:321px){
.overflow{
         width:200px;
         overflow:hidden;

}

.dialog_image{
max-width:400px;}

.poptitle{
font-size:16px;}

.ribbon{
visibility:hidden;
}

}
#image img {
position:relative;
}

#image span {
color:white;
font: bold 12px/23px Helvetica, Sans-Serif;
background: rgba(0, 0, 0, 0.7);
padding: 10px;
position:relative;
bottom:100px;
width:100%
}

#image {
margin-bottom: -90px;
}

</style>

	     <script>
	
var pusher = new Pusher('890abd57f862ab2712ff');
var channel = pusher.subscribe('chickpix')
var gallerybody = ""

$(document).ready(function(){$.get("/recentcheckin", function(data){if (data.recent){$.mobile.changePage('#newgallery')}})}
channel.bind('done',function(){$.mobile.changePage('#newgallery')});
channel.bind('image',function(data){document.getElementById('grid').innerHTML+='<div id=image><a href=/pickmessage?pic_id='+data["entry"][0]+'&venue_id='+data["entry"][3]+'><img src=http://img-s.foursquare.com/userpix/'+data["entry"][0]+'></a><h2><span>'+data["entry"][1]+'</span></h2></div>'});

$('#grid').bind('click', function(){mixpanel.track('clicked-image')});

{% if not has_shared %}
  function show_confirm()
{
var r=confirm("Fourplay will now Checkin to the app for friends to see. This checkin may be sent to Twitter or Facebook.");
if (r==true)
  {
  $.mobile.changePage("/results");
  }
else
  {
  parent.close();
  }
}

{% else %}

function show_confirm(){
$.mobile.changePage("/results");
}

{% endif %}


  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-29130143-1']);
  _gaq.push(['_setDomainName', 'tryfourplay.com']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

//{{sex}}

{% if sex == 'female' %}
var gender='male'
{% else %}
var gender='female'
{% endif %}

{% if lat and lon %}
var lat={{lat}}
var lon={{lon}}
$('main').ready(geo_preloaded);
{%else%}
$('main').ready(initiate_geolocation)	            
{% endif %}

function initiate_geolocation() { navigator.geolocation.getCurrentPosition(handle_geolocation_query,handle_errors);  
	        }


	        function handle_errors(error)  
	        {  
	            switch(error.code)  
	            {  
	                case error.PERMISSION_DENIED: alert("you did not share geolocation data!");  
	                break;  

	                case error.POSITION_UNAVAILABLE: alert("could not detect current position");  
	                break;  

	                case error.TIMEOUT: alert("retrieving position timed out");  
	                break;  

	                default: alert("unknown error");  
	                break;  
	            }  
	        }
					
	

	                function handle_geolocation_query(position){
	                var lat=position.coords.latitude;
	                var lon=position.coords.longitude;
                        lookup(lat,lon);
	                $.ajax({url:"/fsq",data:{'lat':lat,'lon':lon,'gender':gender},type:"GET",timeout:100000,})}

                      function geo_preloaded(){
                         lookup(lat,lon);
                        $.ajax({url:"/fsq",data:{'lat':lat,'lon':lon,'gender':gender},type:"GET",timeout:100000, success: function(data){alert('success');},error: function(data){alert('error');},timeout: function(data){alert('timeout')}})}

//function swapgender(){var origin = "original"; $.ajax({url:"/fsq",data:{'lat':lat,'lon':lon,'gender':'{{sex}}' },type:"GET",timeout:90000})}

    function lookup(lat,lon) {
        $("#venue").foursquareAutocomplete({
            'latitude': lat,
            'longitude': lon,
            'oauth_token': "{{token}}",
            'minLength': 3,
            'search': function (event, ui) {
                $("#venue-name").html(ui.item.name);
                $("#venue-id").val(ui.item.id);
                $("#venue-address").html(ui.item.address);
                $("#venue-cityLine").html(ui.item.cityLine);
                $("#venue-icon").attr("src", ui.item.photo);
                return false;
            },
            'onError' : function (errorCode, errorType, errorDetail) {
var message = "Foursquare Error: Code=" + errorCode + ", errorType= " + errorType + ", errorDetail= " + errorDetail;
log(message);
            }
            
        });
    };
					



$("#missingnumber").live('pageinit',function() {
$('#area_code, #number1, #number2').autotab_magic().autotab_filter('numeric');});


	    </script>  
	</head>
	<body onload="setTimeout(function() { window.scrollTo(0, 1) }, 100);">
		<div data-role="page" id="main">
			<div data-role="content">

					
				
				<div class="geolocmsg">Please ensure geolocation is enabled in your phone's settings.</div>
     <div class="ui-widget">
        <label for="venue">Venue: </label>
        <input id="venue"/>
    </div>
    <div>
        <input type="hidden" id="venue-id"/>
        <div id="venue-name" class="autocomplete-name"></div>
        <div id="venue-address" class="autocomplete-detail"></div>
	<div id="venue-cityLine" class="autocomplete-detail"></div>
	</div>
<div><input type="submit" value="Check in!" onclick=$.post('https://api.foursquare.com/v2/checkins/add',{'venueId':document.getElementById('venue-id').value,'oauth_token':'{{token}}'})></div>
{% if not twitter %}
<input type="text" id="twitter"></input>

<input type="submit" value="OK" onclick=$.post('/updatetwitter/',{'twitter':document.getElementById('twitter').value,'csrfmiddlewaretoken':document.getElementsByName('csrfmiddlewaretoken')[0].value})>
{% csrf_token %}

{% endif %}



</div>

				</div>
		<div data-role="page" id="newgallery">
		  <div data-role="content" id="thegallery">

		    <div id="grid">
		      </div>
		    </div>
</div>

		

	</body>
	
	</html>
